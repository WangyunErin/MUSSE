
syntax = "proto3";

import "google/protobuf/empty.proto";

service Musse {

rpc setup (SetupMessage) returns (google.protobuf.Empty) {}
rpc createOMAP (CreateOMAPMessage) returns (google.protobuf.Empty) {}

rpc readStore (ReadStoreRequest) returns (SearchResponse) {}
rpc writeInStore (WriteStoreRequest) returns (SearchResponse) {}

rpc update (UpdateMessage) returns (google.protobuf.Empty) {}
rpc batchUpdate (BatchUpdateMessage) returns (google.protobuf.Empty) {}

rpc search (SearchMessage) returns (SearchResponse) {}
rpc search1 (SearchMessage1) returns (SearchResponse1) {}

rpc downloadStash (DownloadStashMessage) returns (DownloadStashResponse) {}
rpc uploadStash (UploadStashMessage) returns (google.protobuf.Empty) {}

rpc downloadOMAPRoot (DownloadRootMessage) returns (DownloadRootResponse) {}
rpc uploadOMAPRoot (UploadRootMessage) returns (google.protobuf.Empty) {}

}

message DownloadRootMessage{
    int32 userID = 1;
}

message DownloadRootResponse{
    int32 pos = 1;
    bytes value = 2;
}

message UploadRootMessage{
    int32 userID = 1;
    int32 pos = 2;
    bytes value = 3;
}

message DownloadStashMessage{
    int32 userID = 1;
}

message DownloadStashResponse{
    repeated int32 pos = 1;
    repeated bytes value = 2;
}

message UploadStashMessage{
    int32 userID = 1;
    repeated int32 pos = 2;
    repeated bytes value = 3;
}

message SetupMessage
{
    int32 maxQueueSize = 1;
}

message CreateOMAPMessage
{
    int32 num = 1;    
    int32 userID = 2;
}

message ReadStoreRequest
{
    repeated int32 poses = 1;
    int32 userID = 2;
}

message WriteStoreRequest
{
    //int32 userID = 1;
    repeated int32 pos = 1;
    repeated bytes value = 2;
    repeated int32 size = 3;
    int32 userID = 4;
}

message UpdateMessage
{
    bytes address = 1;
    bytes value = 2;
}

message SearchMessage
{
    repeated bytes address = 1;    
}

message SearchResponse
{
    repeated bytes ciphertext = 1;  
    repeated int32 cipherSize = 2;
    //repeated bytes hash = 3;   
    repeated int32 cipherPositions = 3;   
    //int32 treeSize = 5;
    //repeated int32 proofPosistions = 6;
    
}

message SearchMessage1
{
    repeated bytes address = 1;    
}

message SearchResponse1
{
    repeated bytes ciphertext = 1;  
    //repeated int32 cipherSize = 2;
    //repeated bytes hash = 3;   
    repeated int32 cipherPositions = 2;   
    //int32 treeSize = 5;
    //repeated int32 proofPosistions = 6;
    
}

message BatchUpdateMessage
{
    repeated bytes address = 1;   
    repeated bytes value = 2;   
}
